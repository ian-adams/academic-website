---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { siteConfig } from '@/data/site';
import { getCollection } from 'astro:content';

// Get recent publications and posts
const publications = await getCollection('publications');
const posts = await getCollection('posts', ({ data }) => !data.draft);

const recentPublications = publications
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);

const recentPosts = posts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const featuredPublications = publications
  .filter((pub) => pub.data.featured)
  .slice(0, 3);

const author = siteConfig.author;

// Homepage-specific keywords for SEO
const homeKeywords = [
  'policing scholar',
  'police research',
  'criminology professor',
  'law enforcement research',
  'police accountability',
  'use of force research',
  'body-worn cameras',
  'police technology',
  'evidence-based policing',
  'police policy',
  'Section 1983 expert',
  'police litigation expert witness',
];
---

<BaseLayout
  keywords={homeKeywords}
>
  <!-- Hero Section -->
  <section class="section">
    <div class="container-wide">
      <!-- Hero Header -->
      <header class="border-b-4 border-primary-700 dark:border-primary-500 pb-8 mb-12">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-1 h-12 bg-primary-700 dark:bg-primary-500"></div>
          <span class="text-sm font-bold tracking-widest uppercase text-primary-700 dark:text-primary-400">
            Policing Research & Policy
          </span>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">
          <!-- Profile Image -->
          <div class="lg:col-span-1 flex justify-center lg:justify-start">
            <div class="relative">
              <div class="w-40 h-40 md:w-48 md:h-48 rounded-full overflow-hidden border-4 border-primary-700 dark:border-primary-500 shadow-xl">
                <img
                  src="/media/avatar.jpg"
                  alt={author.name}
                  width="192"
                  height="192"
                  class="w-full h-full object-cover"
                  loading="eager"
                />
              </div>
            </div>
          </div>

          <!-- Bio -->
          <div class="lg:col-span-3">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold text-gray-900 dark:text-white leading-tight mb-2">
              {author.name}
            </h1>
            <p class="text-xl md:text-2xl text-primary-700 dark:text-primary-400 font-medium mb-2">
              {author.role}
            </p>
            <p class="text-lg text-gray-500 dark:text-gray-400 italic mb-6">
              <a href={author.institutionUrl} target="_blank" rel="noopener noreferrer" class="hover:underline">
                {author.institution}
              </a>
            </p>

            <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 max-w-3xl font-light leading-relaxed mb-6">
              {author.bio.split('\n\n')[0]}
            </p>

            <!-- Interests -->
            <div class="flex flex-wrap gap-2 mb-6">
              {author.interests.map((interest) => (
                <span class="px-4 py-1.5 bg-primary-100 dark:bg-primary-900/50 text-primary-800 dark:text-primary-300 rounded-full text-sm font-medium border border-primary-200 dark:border-primary-800">
                  {interest}
                </span>
              ))}
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4">
              <a href="/publications" class="btn-primary px-6 py-3 font-semibold">
                View Publications
              </a>
              <a href={author.cv} target="_blank" rel="noopener noreferrer" class="btn-secondary px-6 py-3 font-semibold border-2 border-primary-700 dark:border-primary-500 text-primary-700 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/30">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Download CV
              </a>
            </div>
          </div>
        </div>
      </header>
    </div>
  </section>

  <!-- Recent Publications -->
  <section class="section bg-gray-50 dark:bg-gray-900/50">
    <div class="container-wide">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-1 h-8 bg-primary-700 dark:bg-primary-500"></div>
        <span class="text-sm font-bold tracking-widest uppercase text-primary-700 dark:text-primary-400">
          Latest Work
        </span>
      </div>
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl md:text-4xl font-serif font-bold text-gray-900 dark:text-white">
          Recent Publications
        </h2>
        <a href="/publications" class="text-primary-700 dark:text-primary-400 hover:underline font-semibold flex items-center gap-1">
          View all <span>&rarr;</span>
        </a>
      </div>

      <div class="space-y-4">
        {recentPublications.map((pub) => (
          <article class="bg-white dark:bg-gray-800 border-l-4 border-primary-700 dark:border-primary-500 rounded-r-lg shadow-sm hover:shadow-md transition-shadow">
            <a href={`/publications/${pub.slug}`} class="block p-6 group">
              <h3 class="text-lg font-serif font-bold text-gray-900 dark:text-white group-hover:text-primary-700 dark:group-hover:text-primary-400 transition-colors mb-2">
                {pub.data.title}
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                {pub.data.authors.join(', ')}
              </p>
              <div class="flex items-center gap-4 text-sm">
                <span class="font-medium text-primary-700 dark:text-primary-400">{pub.data.publication}</span>
                <span class="text-gray-500 dark:text-gray-500">{pub.data.date.getFullYear()}</span>
              </div>
            </a>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Recent Posts -->
  {recentPosts.length > 0 && (
    <section class="section">
      <div class="container-wide">
        <div class="flex items-center gap-3 mb-2">
          <div class="w-1 h-8 bg-primary-700 dark:bg-primary-500"></div>
          <span class="text-sm font-bold tracking-widest uppercase text-primary-700 dark:text-primary-400">
            Commentary
          </span>
        </div>
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-3xl md:text-4xl font-serif font-bold text-gray-900 dark:text-white">
            Recent Posts
          </h2>
          <a href="/posts" class="text-primary-700 dark:text-primary-400 hover:underline font-semibold flex items-center gap-1">
            View all <span>&rarr;</span>
          </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {recentPosts.map((post) => (
            <article class="bg-white dark:bg-gray-800 border-l-4 border-primary-700 dark:border-primary-500 rounded-r-lg shadow-sm hover:shadow-md transition-shadow">
              <a href={`/posts/${post.slug}`} class="block p-6 group">
                <time class="text-xs font-semibold text-primary-700 dark:text-primary-400 uppercase tracking-wide">
                  {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                </time>
                <h3 class="text-lg font-serif font-bold text-gray-900 dark:text-white group-hover:text-primary-700 dark:group-hover:text-primary-400 transition-colors mt-2">
                  {post.data.title}
                </h3>
                {post.data.subtitle && (
                  <p class="text-gray-600 dark:text-gray-400 mt-2 line-clamp-2">
                    {post.data.subtitle}
                  </p>
                )}
              </a>
            </article>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Featured Tools -->
  <section class="section bg-gray-50 dark:bg-gray-900/50">
    <div class="container-wide">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-1 h-8 bg-primary-700 dark:bg-primary-500"></div>
        <span class="text-sm font-bold tracking-widest uppercase text-primary-700 dark:text-primary-400">
          Interactive
        </span>
      </div>
      <h2 class="text-3xl md:text-4xl font-serif font-bold text-gray-900 dark:text-white mb-8">
        Research Tools & Feeds
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <a href="/dashboard" class="group bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-all border-2 border-transparent hover:border-primary-700 dark:hover:border-primary-500 overflow-hidden">
          <div class="h-2 bg-teal-600"></div>
          <div class="p-6">
            <div class="w-12 h-12 bg-teal-100 dark:bg-teal-900/50 rounded-lg flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-teal-600 dark:group-hover:text-teal-400 transition-colors">
              MPV Dashboard
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Interactive analysis of Mapping Police Violence data
            </p>
          </div>
        </a>

        <a href="/dashboard/profanity" class="group bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-all border-2 border-transparent hover:border-primary-700 dark:hover:border-primary-500 overflow-hidden">
          <div class="h-2 bg-purple-600"></div>
          <div class="p-6">
            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/50 rounded-lg flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors">
              Profanity Dashboard
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              How police profanity is judged by target & intent
            </p>
          </div>
        </a>

        <a href="/ai-news" class="group bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-all border-2 border-transparent hover:border-primary-700 dark:hover:border-primary-500 overflow-hidden">
          <div class="h-2 bg-blue-600"></div>
          <div class="p-6">
            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/50 rounded-lg flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
              AI in Policing News
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Curated feed of AI and policing news
            </p>
          </div>
        </a>

        <a href="/k9-incidents" class="group bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-all border-2 border-transparent hover:border-primary-700 dark:hover:border-primary-500 overflow-hidden">
          <div class="h-2 bg-amber-600"></div>
          <div class="p-6">
            <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900/50 rounded-lg flex items-center justify-center mb-4">
              <svg class="w-6 h-6 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-amber-600 dark:group-hover:text-amber-400 transition-colors">
              K9 Incidents
            </h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Police K9 incident news coverage
            </p>
          </div>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
